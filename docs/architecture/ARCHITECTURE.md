# Keco Studio - é¡¹ç›®æ¶æ„æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-30  
**é¡¹ç›®**: Keco Studio - åä½œå¼èµ„äº§ç®¡ç†å¹³å°  
**æŠ€æœ¯æ ˆ**: Next.js 16 + Supabase + Yjs + React 18

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æŠ€æœ¯æ ˆè¯¦è§£](#æŠ€æœ¯æ ˆè¯¦è§£)
4. [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
5. [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
6. [æ•°æ®åº“æ¶æ„](#æ•°æ®åº“æ¶æ„)
7. [å…³é”®æ•°æ®æµ](#å…³é”®æ•°æ®æµ)
8. [å®æ—¶åä½œæ¶æ„](#å®æ—¶åä½œæ¶æ„)
9. [è®¤è¯ä¸æˆæƒ](#è®¤è¯ä¸æˆæƒ)
10. [API è·¯ç”±](#api-è·¯ç”±)
11. [çŠ¶æ€ç®¡ç†](#çŠ¶æ€ç®¡ç†)
12. [æ–‡ä»¶ä¸Šä¼ ä¸å­˜å‚¨](#æ–‡ä»¶ä¸Šä¼ ä¸å­˜å‚¨)
13. [ç‰ˆæœ¬æ§åˆ¶](#ç‰ˆæœ¬æ§åˆ¶)
14. [æµ‹è¯•æ¶æ„](#æµ‹è¯•æ¶æ„)
15. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
16. [å·²çŸ¥ç—›ç‚¹](#å·²çŸ¥ç—›ç‚¹)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç®€ä»‹

Keco Studio æ˜¯ä¸€ä¸ª**å¤šäººå®æ—¶åä½œçš„èµ„äº§ç®¡ç†å¹³å°**ï¼Œå…è®¸å›¢é˜Ÿåˆ›å»ºé¡¹ç›®ã€å®šä¹‰èµ„äº§åº“ï¼ˆLibrariesï¼‰ã€ç®¡ç†èµ„äº§ï¼ˆAssetsï¼‰åŠå…¶è‡ªå®šä¹‰å­—æ®µï¼Œå¹¶æ”¯æŒå®æ—¶å¤šäººç¼–è¾‘ã€ç‰ˆæœ¬æ§åˆ¶ã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **é¡¹ç›®ç®¡ç†**: åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤é¡¹ç›®
2. **èµ„äº§åº“ç®¡ç†**: åœ¨é¡¹ç›®ä¸‹åˆ›å»ºå¤šä¸ªèµ„äº§åº“ï¼Œæ¯ä¸ªåº“å¯è‡ªå®šä¹‰å­—æ®µç»“æ„
3. **èµ„äº§ç®¡ç†**: åœ¨åº“ä¸­åˆ›å»ºèµ„äº§ï¼Œå¡«å†™è‡ªå®šä¹‰å­—æ®µå€¼ï¼Œæ”¯æŒå¤šç§æ•°æ®ç±»å‹
4. **å®æ—¶åä½œ**: å¤šç”¨æˆ·åŒæ—¶ç¼–è¾‘ï¼Œæ”¯æŒ presence trackingï¼ˆæ˜¾ç¤ºè°åœ¨ç¼–è¾‘ä»€ä¹ˆï¼‰
5. **ç‰ˆæœ¬æ§åˆ¶**: ä¸ºèµ„äº§åº“åˆ›å»ºç‰ˆæœ¬å¿«ç…§ï¼Œæ”¯æŒæ¢å¤åˆ°å†å²ç‰ˆæœ¬
6. **æƒé™ç®¡ç†**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆAdmin/Editor/Viewerï¼‰
7. **æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒå›¾ç‰‡å’Œåª’ä½“æ–‡ä»¶ä¸Šä¼ 
8. **æ–‡ä»¶å¤¹ç»„ç»‡**: æ”¯æŒæ–‡ä»¶å¤¹å±‚çº§ç»“æ„ç»„ç»‡èµ„äº§åº“

### ç›®æ ‡ç”¨æˆ·

- æ¸¸æˆå¼€å‘å›¢é˜Ÿï¼ˆç®¡ç†æ¸¸æˆèµ„äº§ï¼‰
- å†…å®¹åˆ›ä½œå›¢é˜Ÿï¼ˆç®¡ç†åª’ä½“èµ„æºï¼‰
- äº§å“å›¢é˜Ÿï¼ˆç®¡ç†äº§å“éœ€æ±‚å’Œè§„æ ¼ï¼‰

---

## ç³»ç»Ÿæ¶æ„

### é«˜å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Client Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Next.js 16 App Router (React 18)               â”‚   â”‚
â”‚  â”‚  â€¢ Server Components (RSC)                                â”‚   â”‚
â”‚  â”‚  â€¢ Client Components ('use client')                       â”‚   â”‚
â”‚  â”‚  â€¢ API Routes (/app/api/*)                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    State & Collaboration Layer                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ React Query  â”‚  â”‚  Yjs (CRDT)  â”‚  â”‚  Supabase Realtime   â”‚  â”‚
â”‚  â”‚ (Data Cache) â”‚  â”‚  (Local Doc) â”‚  â”‚  (Presence/Updates)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          Context Providers                                â”‚   â”‚
â”‚  â”‚  â€¢ AuthContext  â€¢ LibraryDataContext                      â”‚   â”‚
â”‚  â”‚  â€¢ PresenceContext  â€¢ NavigationContext                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Backend & Data Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Supabase Backend                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ PostgreSQL â”‚  â”‚   Auth     â”‚  â”‚   Storage        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   (RLS)    â”‚  â”‚  (JWT)     â”‚  â”‚  (S3-compatible) â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   â”‚
â”‚  â”‚  â”‚  Realtime  â”‚  â”‚  Functions â”‚                          â”‚   â”‚
â”‚  â”‚  â”‚ (Presence) â”‚  â”‚  (SQL)     â”‚                          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Persistence Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  IndexedDB       â”‚  â”‚  Session/Cookie Storage          â”‚    â”‚
â”‚  â”‚  (Yjs Docs)      â”‚  â”‚  (Auth Tokens)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„åˆ†å±‚è¯´æ˜

#### 1. Client Layer (å®¢æˆ·ç«¯å±‚)
- **Next.js App Router**: ä½¿ç”¨ Next.js 16 çš„ App Router æ¶æ„
- **Server Components**: ç”¨äºåˆå§‹æ•°æ®åŠ è½½å’ŒSEOä¼˜åŒ–
- **Client Components**: ç”¨äºäº¤äº’å¼UIå’Œå®æ—¶æ›´æ–°
- **API Routes**: å¤„ç†æœåŠ¡å™¨ç«¯ä¸šåŠ¡é€»è¾‘

#### 2. State & Collaboration Layer (çŠ¶æ€ä¸åä½œå±‚)
- **React Query (@tanstack/react-query)**: æ•°æ®è·å–å’Œç¼“å­˜ç®¡ç†
- **Yjs**: CRDT (Conflict-free Replicated Data Type) ç”¨äºæœ¬åœ°æ–‡æ¡£çŠ¶æ€
- **Supabase Realtime**: å®æ—¶æ•°æ®åº“è®¢é˜…å’Œpresence tracking
- **Context Providers**: React Context ç”¨äºå…¨å±€çŠ¶æ€ç®¡ç†

#### 3. Backend & Data Layer (åç«¯ä¸æ•°æ®å±‚)
- **Supabase**: BaaS (Backend as a Service)
  - PostgreSQL æ•°æ®åº“ï¼ˆå¸¦Row Level Securityï¼‰
  - Authentication (JWT-based)
  - Storage (æ–‡ä»¶å­˜å‚¨)
  - Realtime (WebSocketè¿æ¥)
  - Database Functions (å­˜å‚¨è¿‡ç¨‹)

#### 4. Persistence Layer (æŒä¹…åŒ–å±‚)
- **IndexedDB**: æµè§ˆå™¨æœ¬åœ°å­˜å‚¨Yjsæ–‡æ¡£
- **Session Storage**: å­˜å‚¨è®¤è¯ä»¤ç‰Œå’Œä¼šè¯æ•°æ®

---

## æŠ€æœ¯æ ˆè¯¦è§£

### å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Next.js** | 16.0.0 | React æ¡†æ¶ï¼ŒApp Routerï¼ŒSSR/SSG |
| **React** | 18.3.1 | UI åº“ |
| **React DOM** | 18.3.1 | React æ¸²æŸ“ |
| **TypeScript** | 5.9.3 | ç±»å‹å®‰å…¨ |
| **Ant Design** | 5.22.2 | UI ç»„ä»¶åº“ |
| **@tanstack/react-query** | 5.90.16 | æ•°æ®è·å–å’Œç¼“å­˜ |
| **Yjs** | 13.6.29 | CRDT å®æ—¶åä½œ |
| **y-indexeddb** | 9.0.12 | Yjs IndexedDB æŒä¹…åŒ– |
| **@dnd-kit** | 6.3.1 | æ‹–æ‹½åŠŸèƒ½ |
| **Zod** | 3.22.4 | Schema éªŒè¯ |

### åç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Supabase** | 2.87.1 | BaaS å¹³å° |
| **@supabase/ssr** | 0.8.0 | Next.js SSR é›†æˆ |
| **@supabase/auth-helpers-nextjs** | 0.15.0 | è®¤è¯è¾…åŠ© |
| **PostgreSQL** | (Supabaseç®¡ç†) | å…³ç³»å‹æ•°æ®åº“ |
| **Resend** | 6.7.0 | é‚®ä»¶å‘é€æœåŠ¡ |
| **Jose** | 6.1.3 | JWT å¤„ç† |

### å¼€å‘ä¸æµ‹è¯•å·¥å…·

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Playwright** | 1.57.0 | E2E æµ‹è¯• |
| **ESLint** | 9.0.0 | ä»£ç æ£€æŸ¥ |
| **Autoprefixer** | 10.4.22 | CSS è‡ªåŠ¨å‰ç¼€ |
| **PostCSS** | 8.5.6 | CSS å¤„ç† |

---

## ç›®å½•ç»“æ„

### é¡¹ç›®æ ¹ç›®å½•

```
keco-studio/
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ app/                # Next.js App Router é¡µé¢å’Œè·¯ç”±
â”‚   â”œâ”€â”€ components/         # React ç»„ä»¶
â”‚   â”œâ”€â”€ lib/                # æ ¸å¿ƒåº“å’Œå·¥å…·
â”‚   â”œâ”€â”€ contexts/           # React Contextï¼ˆå·²åºŸå¼ƒï¼Œç°åœ¨åœ¨ lib/contextsï¼‰
â”‚   â”œâ”€â”€ emails/             # é‚®ä»¶æ¨¡æ¿
â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ Hooksï¼ˆéƒ¨åˆ†å·²è¿ç§»åˆ° lib/hooksï¼‰
â”‚   â””â”€â”€ middleware.ts       # Next.js ä¸­é—´ä»¶ï¼ˆè®¤è¯æ£€æŸ¥ï¼‰
â”œâ”€â”€ supabase/               # Supabase é…ç½®å’Œè¿ç§»
â”‚   â”œâ”€â”€ migrations/         # æ•°æ®åº“è¿ç§»æ–‡ä»¶ï¼ˆ40+ ä¸ªè¿ç§»ï¼‰
â”‚   â”œâ”€â”€ config.toml         # Supabase é…ç½®
â”‚   â”œâ”€â”€ seed.sql            # æœ¬åœ°å¼€å‘ç§å­æ•°æ®
â”‚   â””â”€â”€ seed-remote.sql     # è¿œç¨‹æ•°æ®åº“ç§å­æ•°æ®
â”œâ”€â”€ tests/                  # Playwright E2E æµ‹è¯•
â”‚   â””â”€â”€ e2e/
â”‚       â”œâ”€â”€ pages/          # Page Object Model
â”‚       â”œâ”€â”€ specs/          # æµ‹è¯•è§„æ ¼
â”‚       â””â”€â”€ fixtures/       # æµ‹è¯•å›ºå®šè£…ç½®
â”œâ”€â”€ docs/                   # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ architecture/       # æ¶æ„æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰
â”‚   â”œâ”€â”€ CI_SETUP.md         # CI/CD è®¾ç½®æŒ‡å—
â”‚   â””â”€â”€ ENVIRONMENT_SETUP.md # ç¯å¢ƒé…ç½®æŒ‡å—
â”œâ”€â”€ specs/                  # åŠŸèƒ½è§„æ ¼ï¼ˆä½¿ç”¨ speckitï¼‰
â”œâ”€â”€ scripts/                # æ„å»ºå’Œå·¥å…·è„šæœ¬
â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”œâ”€â”€ types/                  # å…¨å±€ TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ package.json            # ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json           # TypeScript é…ç½®
â”œâ”€â”€ playwright.config.ts    # Playwright é…ç½®
â””â”€â”€ next.config.mjs         # Next.js é…ç½®
```

### src/ ç›®å½•è¯¦ç»†ç»“æ„

```
src/
â”œâ”€â”€ app/                              # Next.js 16 App Router
â”‚   â”œâ”€â”€ (dashboard)/                  # è·¯ç”±ç»„ï¼ˆå…±äº«å¸ƒå±€ï¼‰
â”‚   â”‚   â”œâ”€â”€ layout.tsx                # Dashboard å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx                  # Dashboard é¦–é¡µï¼ˆé‡å®šå‘åˆ° /projectsï¼‰
â”‚   â”‚   â”œâ”€â”€ projects/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx              # é¡¹ç›®åˆ—è¡¨é¡µ
â”‚   â”‚   â””â”€â”€ [projectId]/              # åŠ¨æ€è·¯ç”±ï¼šé¡¹ç›®è¯¦æƒ…
â”‚   â”‚       â”œâ”€â”€ page.tsx              # é¡¹ç›®è¯¦æƒ…é¡µ
â”‚   â”‚       â”œâ”€â”€ collaborators/
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx          # åä½œè€…ç®¡ç†é¡µ
â”‚   â”‚       â”œâ”€â”€ folder/
â”‚   â”‚       â”‚   â””â”€â”€ [folderId]/
â”‚   â”‚       â”‚       â””â”€â”€ page.tsx      # æ–‡ä»¶å¤¹è¯¦æƒ…é¡µ
â”‚   â”‚       â””â”€â”€ [libraryId]/          # åŠ¨æ€è·¯ç”±ï¼šèµ„äº§åº“
â”‚   â”‚           â”œâ”€â”€ layout.tsx        # åº“å¸ƒå±€ï¼ˆå¸¦ä¾§è¾¹æ ï¼‰
â”‚   â”‚           â”œâ”€â”€ page.tsx          # åº“ä¸»é¡µï¼ˆèµ„äº§è¡¨æ ¼ï¼‰
â”‚   â”‚           â”œâ”€â”€ predefine/        # å­—æ®µå®šä¹‰é¡µé¢
â”‚   â”‚           â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚           â”‚   â”œâ”€â”€ components/   # å­—æ®µå®šä¹‰ç»„ä»¶
â”‚   â”‚           â”‚   â”œâ”€â”€ hooks/        # å­—æ®µå®šä¹‰ hooks
â”‚   â”‚           â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚           â”‚   â”œâ”€â”€ utils.ts
â”‚   â”‚           â”‚   â””â”€â”€ validation.ts
â”‚   â”‚           â””â”€â”€ [assetId]/        # åŠ¨æ€è·¯ç”±ï¼šèµ„äº§è¯¦æƒ…
â”‚   â”‚               â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ api/                          # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ projects/
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts              # POST /api/projects (åˆ›å»ºé¡¹ç›®)
â”‚   â”‚   â”‚   â””â”€â”€ [projectId]/
â”‚   â”‚   â”‚       â”œâ”€â”€ libraries/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts      # POST åˆ›å»ºåº“
â”‚   â”‚   â”‚       â”œâ”€â”€ folders/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts      # POST åˆ›å»ºæ–‡ä»¶å¤¹
â”‚   â”‚   â”‚       â”œâ”€â”€ role/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts      # GET è·å–ç”¨æˆ·è§’è‰²
â”‚   â”‚   â”‚       â””â”€â”€ delete/
â”‚   â”‚   â”‚           â””â”€â”€ route.ts      # DELETE åˆ é™¤é¡¹ç›®
â”‚   â”‚   â”œâ”€â”€ libraries/
â”‚   â”‚   â”‚   â””â”€â”€ [libraryId]/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts          # PUT/DELETE åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ collaborators/
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts              # GET è·å–åä½œè€…
â”‚   â”‚   â”‚   â””â”€â”€ [collaboratorId]/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts          # DELETE åˆ é™¤åä½œè€…
â”‚   â”‚   â””â”€â”€ invitations/
â”‚   â”‚       â”œâ”€â”€ route.ts              # POST å‘é€é‚€è¯·
â”‚   â”‚       â”œâ”€â”€ accept/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts          # POST æ¥å—é‚€è¯·
â”‚   â”‚       â””â”€â”€ decline/
â”‚   â”‚           â””â”€â”€ route.ts          # POST æ‹’ç»é‚€è¯·
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ callback/                 # Supabase è®¤è¯å›è°ƒ
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ reset-password/           # é‡ç½®å¯†ç é¡µ
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ accept-invitation/            # æ¥å—é‚€è¯·é¡µ
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ AcceptInvitationContent.tsx
â”‚   â”œâ”€â”€ decline-invitation/           # æ‹’ç»é‚€è¯·é¡µ
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ forgot-password/              # å¿˜è®°å¯†ç é¡µ
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ assets/                       # èµ„äº§è¯¦æƒ…ï¼ˆå¯èƒ½å·²åºŸå¼ƒï¼‰
â”‚   â”œâ”€â”€ realtime-test/                # Realtime æµ‹è¯•é¡µï¼ˆå¼€å‘ç”¨ï¼‰
â”‚   â”œâ”€â”€ layout.tsx                    # å…¨å±€å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx                      # é¦–é¡µï¼ˆç™»å½•é¡µï¼‰
â”‚   â””â”€â”€ globals.css                   # å…¨å±€æ ·å¼
â”œâ”€â”€ components/                       # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ layout/                       # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx               # ä¾§è¾¹æ ï¼ˆ2330è¡Œï¼Œå¤æ‚ç»„ä»¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ TopBar.tsx                # é¡¶éƒ¨å¯¼èˆªæ 
â”‚   â”‚   â”œâ”€â”€ DashboardLayout.tsx       # Dashboard å¸ƒå±€å®¹å™¨
â”‚   â”‚   â””â”€â”€ ContextMenu.tsx           # å³é”®èœå•
â”‚   â”œâ”€â”€ projects/                     # é¡¹ç›®ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ NewProjectModal.tsx
â”‚   â”‚   â””â”€â”€ EditProjectModal.tsx
â”‚   â”œâ”€â”€ libraries/                    # èµ„äº§åº“ç»„ä»¶ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰
â”‚   â”‚   â”œâ”€â”€ LibraryAssetsTable.tsx    # ä¸»è¡¨æ ¼ç»„ä»¶ï¼ˆ2335è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ LibraryAssetsTableAdapter.tsx  # è¡¨æ ¼é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ LibraryAssetsTableModals.tsx   # è¡¨æ ¼ç›¸å…³å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ LibraryHeader.tsx         # åº“å¤´éƒ¨
â”‚   â”‚   â”œâ”€â”€ NewLibraryModal.tsx
â”‚   â”‚   â”œâ”€â”€ EditLibraryModal.tsx
â”‚   â”‚   â”œâ”€â”€ AddLibraryMenu.tsx
â”‚   â”‚   â”œâ”€â”€ components/               # åº“å­ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ CellEditor.tsx        # å•å…ƒæ ¼ç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ReferenceField.tsx    # å¼•ç”¨å­—æ®µ
â”‚   â”‚   â”‚   â”œâ”€â”€ TableHeader.tsx       # è¡¨å¤´
â”‚   â”‚   â”‚   â”œâ”€â”€ RowContextMenu.tsx    # è¡Œå³é”®èœå•
â”‚   â”‚   â”‚   â”œâ”€â”€ CellPresenceAvatars.tsx  # åä½œå¤´åƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ AssetCardPanel.tsx    # èµ„äº§å¡ç‰‡é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ TableToast.tsx        # è¡¨æ ¼æç¤º
â”‚   â”‚   â”‚   â”œâ”€â”€ BatchEditMenu.tsx     # æ‰¹é‡ç¼–è¾‘èœå•
â”‚   â”‚   â”‚   â””â”€â”€ EmptyState.tsx        # ç©ºçŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ hooks/                    # è¡¨æ ¼ä¸“ç”¨ hooksï¼ˆå…³é”®æ¨¡å—ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ useTableDataManager.ts  # è¡¨æ ¼æ•°æ®ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ useRowOperations.ts   # è¡Œæ“ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ useCellEditing.ts     # å•å…ƒæ ¼ç¼–è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ useCellSelection.ts   # å•å…ƒæ ¼é€‰æ‹©
â”‚   â”‚   â”‚   â”œâ”€â”€ useClipboardOperations.ts  # å‰ªè´´æ¿æ“ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ useClipboardShortcuts.ts   # å‰ªè´´æ¿å¿«æ·é”®
â”‚   â”‚   â”‚   â”œâ”€â”€ useBatchFill.ts       # æ‰¹é‡å¡«å……
â”‚   â”‚   â”‚   â”œâ”€â”€ useAddRow.ts          # æ·»åŠ è¡Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ useReferenceModal.ts  # å¼•ç”¨å¼¹çª—
â”‚   â”‚   â”‚   â”œâ”€â”€ useYjsSync.ts         # Yjs åŒæ­¥
â”‚   â”‚   â”‚   â”œâ”€â”€ useResolvedRows.ts    # è§£æè¡Œæ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ useClickOutsideAutoSave.ts  # ç‚¹å‡»å¤–éƒ¨è‡ªåŠ¨ä¿å­˜
â”‚   â”‚   â”‚   â”œâ”€â”€ useOptimisticCleanup.ts     # ä¹è§‚æ›´æ–°æ¸…ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ useUserRole.ts        # ç”¨æˆ·è§’è‰²
â”‚   â”‚   â”‚   â”œâ”€â”€ useTableMenuPosition.ts     # è¡¨æ ¼èœå•ä½ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ useCloseOnDocumentClick.ts  # ç‚¹å‡»å…³é—­
â”‚   â”‚   â”‚   â””â”€â”€ useAssetHover.ts      # èµ„äº§æ‚¬åœ
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ libraryAssetUtils.ts  # èµ„äº§å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ asset/                        # èµ„äº§è¯¦æƒ…ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AssetHeader.tsx
â”‚   â”‚   â”œâ”€â”€ EditAssetModal.tsx
â”‚   â”‚   â”œâ”€â”€ AssetReferenceSelector.tsx
â”‚   â”‚   â””â”€â”€ AssetReferenceModal.tsx
â”‚   â”œâ”€â”€ folders/                      # æ–‡ä»¶å¤¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ LibraryCard.tsx
â”‚   â”‚   â”œâ”€â”€ FolderCard.tsx
â”‚   â”‚   â”œâ”€â”€ LibraryListView.tsx
â”‚   â”‚   â”œâ”€â”€ LibraryToolbar.tsx
â”‚   â”‚   â”œâ”€â”€ LibraryCardMenu.tsx
â”‚   â”‚   â”œâ”€â”€ NewFolderModal.tsx
â”‚   â”‚   â””â”€â”€ EditFolderModal.tsx
â”‚   â”œâ”€â”€ collaboration/                # åä½œç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ CollaboratorsList.tsx
â”‚   â”‚   â”œâ”€â”€ InviteCollaboratorModal.tsx
â”‚   â”‚   â”œâ”€â”€ PresenceIndicators.tsx
â”‚   â”‚   â”œâ”€â”€ StackedAvatars.tsx
â”‚   â”‚   â”œâ”€â”€ ConnectionStatusIndicator.tsx
â”‚   â”‚   â””â”€â”€ FieldPresenceAvatars.tsx
â”‚   â”œâ”€â”€ version-control/              # ç‰ˆæœ¬æ§åˆ¶ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ VersionControlSidebar.tsx
â”‚   â”‚   â”œâ”€â”€ VersionList.tsx
â”‚   â”‚   â”œâ”€â”€ VersionItem.tsx
â”‚   â”‚   â”œâ”€â”€ VersionItemMenu.tsx
â”‚   â”‚   â”œâ”€â”€ CreateVersionModal.tsx
â”‚   â”‚   â”œâ”€â”€ EditVersionModal.tsx
â”‚   â”‚   â”œâ”€â”€ RestoreButton.tsx
â”‚   â”‚   â”œâ”€â”€ RestoreConfirmModal.tsx
â”‚   â”‚   â””â”€â”€ DeleteConfirmModal.tsx
â”‚   â”œâ”€â”€ media/                        # åª’ä½“ä¸Šä¼ ç»„ä»¶
â”‚   â”‚   â””â”€â”€ MediaFileUpload.tsx
â”‚   â””â”€â”€ authform/                     # è®¤è¯è¡¨å•
â”‚       â””â”€â”€ AuthForm.tsx
â”œâ”€â”€ lib/                              # æ ¸å¿ƒåº“ï¼ˆé‡è¦æ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ contexts/                     # React Contextï¼ˆå…¨å±€çŠ¶æ€ï¼‰
â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx           # è®¤è¯ä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ LibraryDataContext.tsx    # åº“æ•°æ®ä¸Šä¸‹æ–‡ï¼ˆ668è¡Œï¼Œæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ PresenceContext.tsx       # Presence ä¸Šä¸‹æ–‡
â”‚   â”‚   â””â”€â”€ NavigationContext.tsx     # å¯¼èˆªä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ services/                     # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ projectService.ts         # é¡¹ç›®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ libraryService.ts         # åº“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ libraryAssetsService.ts   # èµ„äº§æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ folderService.ts          # æ–‡ä»¶å¤¹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ collaborationService.ts   # åä½œæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ versionService.ts         # ç‰ˆæœ¬æ§åˆ¶æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ authorizationService.ts   # æˆæƒæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ emailService.ts           # é‚®ä»¶æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ imageUploadService.ts     # å›¾ç‰‡ä¸Šä¼ æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ mediaFileUploadService.ts # åª’ä½“æ–‡ä»¶ä¸Šä¼ æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ realtimeService.ts        # Realtime æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ sharedDocumentService.ts  # å…±äº«æ–‡æ¡£æœåŠ¡
â”‚   â”‚   â””â”€â”€ userValidationService.ts  # ç”¨æˆ·éªŒè¯æœåŠ¡
â”‚   â”œâ”€â”€ hooks/                        # å…¨å±€è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useRealtimeSubscription.ts  # Realtime è®¢é˜…
â”‚   â”‚   â”œâ”€â”€ usePresenceTracking.ts    # Presence è¿½è¸ª
â”‚   â”‚   â”œâ”€â”€ useCacheMutations.ts      # ç¼“å­˜å˜æ›´
â”‚   â”‚   â”œâ”€â”€ useRequestCache.ts        # è¯·æ±‚ç¼“å­˜
â”‚   â”‚   â””â”€â”€ useCollaboratorPermissions.ts  # åä½œè€…æƒé™
â”‚   â”œâ”€â”€ actions/                      # Server Actions
â”‚   â”‚   â””â”€â”€ collaboration.ts
â”‚   â”œâ”€â”€ types/                        # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ libraryAssets.ts
â”‚   â”‚   â”œâ”€â”€ collaboration.ts
â”‚   â”‚   â”œâ”€â”€ version.ts
â”‚   â”‚   â””â”€â”€ shared-document.ts
â”‚   â”œâ”€â”€ utils/                        # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ queryKeys.ts              # React Query keys
â”‚   â”‚   â”œâ”€â”€ avatarColors.ts           # å¤´åƒé¢œè‰²ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ dateTime.ts               # æ—¥æœŸæ—¶é—´å·¥å…·
â”‚   â”‚   â”œâ”€â”€ nameValidation.ts         # åç§°éªŒè¯
â”‚   â”‚   â”œâ”€â”€ invitationToken.ts        # é‚€è¯·ä»¤ç‰Œç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ requestTimeout.ts         # è¯·æ±‚è¶…æ—¶
â”‚   â”‚   â”œâ”€â”€ cookieStorageAdapter.ts   # Cookie å­˜å‚¨é€‚é…å™¨
â”‚   â”‚   â””â”€â”€ cacheDebugger.ts          # ç¼“å­˜è°ƒè¯•å·¥å…·
â”‚   â”œâ”€â”€ providers/                    # Provider ç»„ä»¶
â”‚   â”‚   â””â”€â”€ QueryProvider.tsx         # React Query Provider
â”‚   â”œâ”€â”€ supabase.ts                   # Supabase å®¢æˆ·ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰
â”‚   â”œâ”€â”€ createSupabaseServerClient.ts # Supabase æœåŠ¡ç«¯å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ SupabaseContext.tsx           # Supabase Context
â”‚   â”œâ”€â”€ useSupabaseClient.ts          # Supabase Hook
â”‚   â”œâ”€â”€ hybridStorageAdapter.ts       # æ··åˆå­˜å‚¨é€‚é…å™¨
â”‚   â”œâ”€â”€ sessionStorageAdapter.ts      # Session å­˜å‚¨é€‚é…å™¨
â”‚   â””â”€â”€ tabIsolatedStorageAdapter.ts  # Tab éš”ç¦»å­˜å‚¨é€‚é…å™¨
â”œâ”€â”€ contexts/                         # æ—§çš„ Context ç›®å½•ï¼ˆå·²åºŸå¼ƒï¼‰
â”‚   â””â”€â”€ YjsContext.tsx                # Yjs Context
â”œâ”€â”€ hooks/                            # æ—§çš„ Hooks ç›®å½•ï¼ˆéƒ¨åˆ†å·²è¿ç§»ï¼‰
â”‚   â””â”€â”€ useYjsRows.ts
â”œâ”€â”€ emails/                           # é‚®ä»¶æ¨¡æ¿
â”‚   â””â”€â”€ invitation-email.tsx
â””â”€â”€ middleware.ts                     # Next.js ä¸­é—´ä»¶ï¼ˆè·¯ç”±ä¿æŠ¤ï¼‰
```

---

## æ ¸å¿ƒæ¨¡å—

### 1. è®¤è¯ä¸æˆæƒæ¨¡å—

**ä½ç½®**: `src/lib/contexts/AuthContext.tsx`, `src/middleware.ts`, `src/lib/services/authorizationService.ts`

**èŒè´£**:
- ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€ç™»å‡º
- JWT Token ç®¡ç†
- è·¯ç”±ä¿æŠ¤ï¼ˆä¸­é—´ä»¶ï¼‰
- åŸºäºè§’è‰²çš„æƒé™æ£€æŸ¥

**å…³é”®ç»„ä»¶**:
- `AuthContext`: æä¾›ç”¨æˆ·è®¤è¯çŠ¶æ€
- `middleware.ts`: Next.js ä¸­é—´ä»¶ï¼Œæ‹¦æˆªæœªè®¤è¯è¯·æ±‚
- `authorizationService.ts`: æƒé™éªŒè¯é€»è¾‘

**æ•°æ®æµ**:
```
ç”¨æˆ·ç™»å½• â†’ Supabase Auth â†’ JWT Token â†’ Cookie/Session Storage
         â†“
    AuthContext å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
         â†“
    ä¸­é—´ä»¶æ£€æŸ¥è®¤è¯çŠ¶æ€ â†’ æœªè®¤è¯é‡å®šå‘åˆ°ç™»å½•é¡µ
         â†“
    ä¸šåŠ¡é€»è¾‘ä½¿ç”¨ authorizationService æ£€æŸ¥æƒé™
```

---

### 2. é¡¹ç›®ä¸èµ„äº§åº“ç®¡ç†æ¨¡å—

**ä½ç½®**: `src/lib/services/projectService.ts`, `src/lib/services/libraryService.ts`, `src/components/projects/*`, `src/components/libraries/*`

**èŒè´£**:
- åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤é¡¹ç›®
- åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤èµ„äº§åº“
- æ–‡ä»¶å¤¹å±‚çº§ç®¡ç†

**å…³é”®ç»„ä»¶**:
- `projectService.ts`: é¡¹ç›®CRUDæ“ä½œ
- `libraryService.ts`: èµ„äº§åº“CRUDæ“ä½œ
- `folderService.ts`: æ–‡ä»¶å¤¹CRUDæ“ä½œ
- `NewProjectModal`, `EditProjectModal`: é¡¹ç›®å¼¹çª—
- `NewLibraryModal`, `EditLibraryModal`: åº“å¼¹çª—

**æ•°æ®åº“è¡¨**:
- `projects`: é¡¹ç›®è¡¨
- `libraries`: èµ„äº§åº“è¡¨
- `folders`: æ–‡ä»¶å¤¹è¡¨

---

### 3. èµ„äº§ç®¡ç†ä¸å®æ—¶åä½œæ¨¡å—ï¼ˆæ ¸å¿ƒï¼‰

**ä½ç½®**: `src/components/libraries/LibraryAssetsTable.tsx`, `src/lib/contexts/LibraryDataContext.tsx`, `src/components/libraries/hooks/*`

**èŒè´£**:
- èµ„äº§ï¼ˆAssetsï¼‰çš„CRUDæ“ä½œ
- èµ„äº§å­—æ®µå€¼çš„ç¼–è¾‘
- å¤šäººå®æ—¶åä½œç¼–è¾‘
- Presence Trackingï¼ˆæ˜¾ç¤ºè°åœ¨ç¼–è¾‘ä»€ä¹ˆï¼‰
- ä¹è§‚æ›´æ–°å’Œå†²çªè§£å†³

**å…³é”®ç»„ä»¶**:
- `LibraryDataContext`: **æ ¸å¿ƒä¸Šä¸‹æ–‡**ï¼Œç®¡ç†åº“æ•°æ®å’Œå®æ—¶åä½œ
- `LibraryAssetsTable`: **ä¸»è¡¨æ ¼ç»„ä»¶**ï¼ˆ2335è¡Œï¼‰ï¼Œå±•ç¤ºå’Œç¼–è¾‘èµ„äº§
- `useTableDataManager`: è¡¨æ ¼æ•°æ®ç®¡ç† Hook
- `useCellEditing`: å•å…ƒæ ¼ç¼–è¾‘é€»è¾‘
- `useYjsSync`: Yjs CRDT åŒæ­¥é€»è¾‘

**æŠ€æœ¯æ ˆ**:
- **Yjs**: CRDTæ•°æ®ç»“æ„ï¼Œæœ¬åœ°çŠ¶æ€ç®¡ç†
- **IndexedDB**: Yjsæ–‡æ¡£æŒä¹…åŒ–
- **Supabase Realtime**: å®æ—¶æ•°æ®åº“è®¢é˜…
- **React Query**: æ•°æ®ç¼“å­˜å’ŒæœåŠ¡ç«¯çŠ¶æ€

**æ•°æ®æµ**:
```
1. åˆå§‹åŠ è½½:
   Supabase DB â†’ React Query â†’ LibraryDataContext â†’ Yjs Doc â†’ IndexedDB
                                      â†“
                              LibraryAssetsTable æ¸²æŸ“

2. ç”¨æˆ·ç¼–è¾‘ï¼ˆæœ¬åœ°ç”¨æˆ·ï¼‰:
   ç”¨æˆ·è¾“å…¥ â†’ useCellEditing â†’ LibraryDataContext.updateAssetField()
                                      â†“
                  Yjs Doc æ›´æ–°ï¼ˆè§¦å‘ observe äº‹ä»¶ï¼‰
                                      â†“
              ç»„ä»¶é‡æ–°æ¸²æŸ“ â†’ Supabase DB æ›´æ–°ï¼ˆå¼‚æ­¥ï¼‰
                                      â†“
                    Realtime å¹¿æ’­ç»™å…¶ä»–ç”¨æˆ·

3. è¿œç¨‹æ›´æ–°ï¼ˆå…¶ä»–ç”¨æˆ·ç¼–è¾‘ï¼‰:
   Supabase Realtime â†’ LibraryDataContext æ”¶åˆ°äº‹ä»¶
                                      â†“
                    Yjs Doc æ›´æ–°ï¼ˆå¦‚æœä¸å†²çªï¼‰
                                      â†“
                ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ˆä¹è§‚æ›´æ–°ï¼‰
```

---

### 4. å­—æ®µå®šä¹‰æ¨¡å—

**ä½ç½®**: `src/app/(dashboard)/[projectId]/[libraryId]/predefine/*`

**èŒè´£**:
- å®šä¹‰èµ„äº§åº“çš„å­—æ®µç»“æ„ï¼ˆSchemaï¼‰
- æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼šText, Number, Boolean, Date, Image, MediaFile, Referenceç­‰
- å­—æ®µçš„æ‹–æ‹½æ’åº
- å­—æ®µåˆ†ç»„ï¼ˆSectionsï¼‰

**å…³é”®ç»„ä»¶**:
- `predefine/page.tsx`: å­—æ®µå®šä¹‰é¡µé¢
- `predefine/components/FieldsList.tsx`: å­—æ®µåˆ—è¡¨
- `predefine/components/FieldForm.tsx`: å­—æ®µè¡¨å•ï¼ˆ530è¡Œï¼‰
- `predefine/components/FieldItem.tsx`: å­—æ®µé¡¹ï¼ˆ509è¡Œï¼‰
- `predefine/components/NewSectionForm.tsx`: æ–°å»ºåˆ†ç»„è¡¨å•
- `predefine/hooks/useSchemaData.ts`: Schema æ•°æ®ç®¡ç†
- `predefine/hooks/useSchemaSave.ts`: Schema ä¿å­˜é€»è¾‘

**æ•°æ®åº“è¡¨**:
- `library_field_definitions`: å­—æ®µå®šä¹‰è¡¨

---

### 5. åä½œä¸æƒé™æ¨¡å—

**ä½ç½®**: `src/lib/services/collaborationService.ts`, `src/components/collaboration/*`, `src/lib/hooks/useCollaboratorPermissions.ts`

**èŒè´£**:
- é‚€è¯·åä½œè€…ï¼ˆå‘é€é‚€è¯·é‚®ä»¶ï¼‰
- ç®¡ç†åä½œè€…è§’è‰²ï¼ˆAdmin/Editor/Viewerï¼‰
- å®æ—¶æ˜¾ç¤ºåä½œè€…çŠ¶æ€
- Presence Trackingï¼ˆè°åœ¨çº¿ï¼Œè°åœ¨ç¼–è¾‘ä»€ä¹ˆï¼‰

**å…³é”®ç»„ä»¶**:
- `collaborationService.ts`: åä½œç›¸å…³ä¸šåŠ¡é€»è¾‘
- `CollaboratorsList.tsx`: åä½œè€…åˆ—è¡¨
- `InviteCollaboratorModal.tsx`: é‚€è¯·å¼¹çª—
- `PresenceIndicators.tsx`: åœ¨çº¿çŠ¶æ€æŒ‡ç¤ºå™¨
- `useCollaboratorPermissions.ts`: æƒé™æ£€æŸ¥ Hook

**æ•°æ®åº“è¡¨**:
- `project_collaborators`: åä½œè€…è¡¨
- `collaboration_invitations`: é‚€è¯·è¡¨

**æƒé™æ¨¡å‹**:
```
Admin:
  - å®Œå…¨è®¿é—®æƒé™
  - å¯ä»¥ç®¡ç†åä½œè€…
  - å¯ä»¥åˆ é™¤é¡¹ç›®

Editor:
  - è¯»å†™æƒé™
  - å¯ä»¥ç¼–è¾‘èµ„äº§å’Œå­—æ®µ
  - ä¸èƒ½ç®¡ç†åä½œè€…

Viewer:
  - åªè¯»æƒé™
  - ä¸èƒ½ä¿®æ”¹ä»»ä½•å†…å®¹
```

---

### 6. ç‰ˆæœ¬æ§åˆ¶æ¨¡å—

**ä½ç½®**: `src/lib/services/versionService.ts`, `src/components/version-control/*`

**èŒè´£**:
- åˆ›å»ºåº“çš„ç‰ˆæœ¬å¿«ç…§
- æ¢å¤åˆ°å†å²ç‰ˆæœ¬
- ç‰ˆæœ¬å¯¹æ¯”ï¼ˆæœªå®ç°ï¼‰

**å…³é”®ç»„ä»¶**:
- `versionService.ts`: ç‰ˆæœ¬CRUDæ“ä½œ
- `VersionControlSidebar.tsx`: ç‰ˆæœ¬ä¾§è¾¹æ 
- `VersionList.tsx`: ç‰ˆæœ¬åˆ—è¡¨
- `CreateVersionModal.tsx`: åˆ›å»ºç‰ˆæœ¬å¼¹çª—
- `RestoreConfirmModal.tsx`: æ¢å¤ç¡®è®¤å¼¹çª—

**æ•°æ®åº“è¡¨**:
- `library_versions`: ç‰ˆæœ¬è¡¨

**ç‰ˆæœ¬ç±»å‹**:
- `manual`: ç”¨æˆ·æ‰‹åŠ¨åˆ›å»º
- `backup`: æ¢å¤å‰çš„å¤‡ä»½
- `restore`: ä»å…¶ä»–ç‰ˆæœ¬æ¢å¤

---

### 7. æ–‡ä»¶ä¸Šä¼ ä¸å­˜å‚¨æ¨¡å—

**ä½ç½®**: `src/lib/services/imageUploadService.ts`, `src/lib/services/mediaFileUploadService.ts`, `src/components/media/*`

**èŒè´£**:
- ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼ˆImageå­—æ®µç±»å‹ï¼‰
- ä¸Šä¼ åª’ä½“æ–‡ä»¶ï¼ˆMediaFileå­—æ®µç±»å‹ï¼‰
- æ–‡ä»¶ç±»å‹éªŒè¯
- æ–‡ä»¶å¤§å°é™åˆ¶

**å…³é”®ç»„ä»¶**:
- `imageUploadService.ts`: å›¾ç‰‡ä¸Šä¼ é€»è¾‘
- `mediaFileUploadService.ts`: åª’ä½“æ–‡ä»¶ä¸Šä¼ é€»è¾‘
- `MediaFileUpload.tsx`: ä¸Šä¼ ç»„ä»¶

**Supabase Storage Buckets**:
- `tiptap-images`: å­˜å‚¨Tiptapç¼–è¾‘å™¨ä¸­çš„å›¾ç‰‡
- `library-media-files`: å­˜å‚¨åº“ä¸­çš„åª’ä½“æ–‡ä»¶

---

### 8. çŠ¶æ€ç®¡ç†ä¸ç¼“å­˜æ¨¡å—

**ä½ç½®**: `src/lib/providers/QueryProvider.tsx`, `src/lib/hooks/useCacheMutations.ts`, `src/lib/hooks/useRequestCache.ts`

**èŒè´£**:
- React Query é…ç½®å’Œç®¡ç†
- ç¼“å­˜å¤±æ•ˆç­–ç•¥
- ä¹è§‚æ›´æ–°
- è¯·æ±‚å»é‡

**å…³é”®ç»„ä»¶**:
- `QueryProvider.tsx`: React Query Provider
- `useCacheMutations.ts`: ç¼“å­˜å˜æ›´ Hook
- `useRequestCache.ts`: è¯·æ±‚ç¼“å­˜ Hook
- `lib/utils/queryKeys.ts`: æŸ¥è¯¢é”®å®šä¹‰

---

## æ•°æ®åº“æ¶æ„

### æ•°æ®åº“ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   profiles   â”‚ (ç”¨æˆ·è¡¨)
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚â—„â”€â”
â”‚ email        â”‚  â”‚
â”‚ display_name â”‚  â”‚
â”‚ avatar_color â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                  â”‚
                  â”‚ owner_id
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     projects     â”‚ (é¡¹ç›®è¡¨)
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)          â”‚â—„â”€â”
â”‚ owner_id (FK)    â”‚  â”‚
â”‚ name             â”‚  â”‚
â”‚ description      â”‚  â”‚
â”‚ created_at       â”‚  â”‚
â”‚ updated_at       â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                      â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                  â”‚ project_id
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ project_collaboratorsâ”‚   â”‚      libraries       â”‚ (èµ„äº§åº“è¡¨)
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)              â”‚   â”‚ id (PK)              â”‚â—„â”€â”
â”‚ user_id (FK)         â”‚   â”‚ project_id (FK)      â”‚  â”‚
â”‚ project_id (FK)      â”‚   â”‚ folder_id (FK)       â”‚  â”‚
â”‚ role (admin/editor/  â”‚   â”‚ name                 â”‚  â”‚
â”‚       viewer)        â”‚   â”‚ description          â”‚  â”‚
â”‚ invited_by (FK)      â”‚   â”‚ created_at           â”‚  â”‚
â”‚ accepted_at          â”‚   â”‚ updated_at           â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ updated_by (FK)      â”‚  â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚collaboration_invitationsâ”‚                          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚ library_id
â”‚ id (PK)              â”‚                            â”‚
â”‚ project_id (FK)      â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚ email                â”‚   â”‚                                â”‚
â”‚ role                 â”‚   â”‚                                â”‚
â”‚ invited_by (FK)      â”‚   â”‚                                â”‚
â”‚ token                â”‚   â”‚                                â”‚
â”‚ expires_at           â”‚   â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                â”‚
                           â”‚                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
        â”‚                              â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ library_field_       â”‚   â”‚  library_assets      â”‚        â”‚
â”‚ definitions          â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚ id (PK)              â”‚â—„â”€â”€â”€â”   â”‚
â”‚ id (PK)              â”‚â—„â”€â”â”‚ library_id (FK)      â”‚    â”‚   â”‚
â”‚ library_id (FK)      â”‚  â”‚â”‚ name                 â”‚    â”‚   â”‚
â”‚ field_name           â”‚  â”‚â”‚ created_at           â”‚    â”‚   â”‚
â”‚ data_type            â”‚  â”‚â”‚ updated_by (FK)      â”‚    â”‚   â”‚
â”‚ is_required          â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚ default_value        â”‚  â”‚                            â”‚   â”‚
â”‚ display_order        â”‚  â”‚                            â”‚   â”‚
â”‚ section_id           â”‚  â”‚ asset_id              asset_idâ”‚
â”‚ field_properties     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ reference_libraries  â”‚             â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                     â”‚
                                     â”‚                     â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
                        â”‚ library_asset_values    â”‚        â”‚
                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚
                        â”‚ asset_id (PK, FK)       â”‚        â”‚
                        â”‚ field_id (PK, FK) â”€â”€â”€â”€â”€â”€â”˜        â”‚
                        â”‚ value_json              â”‚        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   folders            â”‚                                   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                   â”‚
â”‚ id (PK)              â”‚                                   â”‚
â”‚ project_id (FK)      â”‚                                   â”‚
â”‚ parent_folder_id (FK)â”‚ (è‡ªå¼•ç”¨)                          â”‚
â”‚ name                 â”‚                                   â”‚
â”‚ created_at           â”‚                                   â”‚
â”‚ updated_at           â”‚                                   â”‚
â”‚ updated_by (FK)      â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
                                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  library_versions    â”‚                                   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                   â”‚
â”‚ id (PK)              â”‚                                   â”‚
â”‚ library_id (FK) â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ version_name         â”‚
â”‚ version_type         â”‚ (manual/backup/restore)
â”‚ snapshot_data        â”‚ (JSONBï¼Œå­˜å‚¨å®Œæ•´å¿«ç…§)
â”‚ created_by (FK)      â”‚
â”‚ created_at           â”‚
â”‚ is_current           â”‚
â”‚ parent_version_id (FK)â”‚ (è‡ªå¼•ç”¨)
â”‚ restore_from_version_id (FK)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè¡¨è¯¦è§£

#### 1. profilesï¼ˆç”¨æˆ·è¡¨ï¼‰
- Supabase Authçš„æ‰©å±•è¡¨
- å­˜å‚¨ç”¨æˆ·æ˜¾ç¤ºåç§°å’Œå¤´åƒé¢œè‰²

#### 2. projectsï¼ˆé¡¹ç›®è¡¨ï¼‰
- é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯
- æ¯ä¸ªé¡¹ç›®æœ‰ä¸€ä¸ªownerï¼ˆåˆ›å»ºè€…ï¼‰
- æ”¯æŒåä½œè€…é€šè¿‡`project_collaborators`è¡¨

#### 3. librariesï¼ˆèµ„äº§åº“è¡¨ï¼‰
- å±äºæŸä¸ªé¡¹ç›®
- å¯ä»¥åœ¨æ–‡ä»¶å¤¹ä¸­ç»„ç»‡
- æ¯ä¸ªåº“æœ‰è‡ªå·±çš„å­—æ®µå®šä¹‰

#### 4. library_field_definitionsï¼ˆå­—æ®µå®šä¹‰è¡¨ï¼‰
- å®šä¹‰åº“çš„Schema
- æ”¯æŒå¤šç§æ•°æ®ç±»å‹
- æ”¯æŒå­—æ®µåˆ†ç»„ï¼ˆsectionsï¼‰
- `reference_libraries`: å¼•ç”¨ç±»å‹å­—æ®µå¯ä»¥å…³è”å…¶ä»–åº“

#### 5. library_assetsï¼ˆèµ„äº§è¡¨ï¼‰
- èµ„äº§çš„åŸºæœ¬ä¿¡æ¯ï¼ˆIDå’Œåç§°ï¼‰
- å±äºæŸä¸ªåº“

#### 6. library_asset_valuesï¼ˆèµ„äº§å­—æ®µå€¼è¡¨ï¼‰
- å­˜å‚¨èµ„äº§çš„å­—æ®µå€¼
- ä½¿ç”¨JSONBç±»å‹å­˜å‚¨çµæ´»çš„æ•°æ®ç»“æ„
- é€šè¿‡`asset_id`å’Œ`field_id`è”åˆä¸»é”®

#### 7. project_collaboratorsï¼ˆåä½œè€…è¡¨ï¼‰
- é¡¹ç›®çš„åä½œè€…å…³ç³»
- æ”¯æŒä¸‰ç§è§’è‰²ï¼šadmin, editor, viewer
- `accepted_at`ä¸ºNULLè¡¨ç¤ºå¾…æ¥å—çš„é‚€è¯·

#### 8. library_versionsï¼ˆç‰ˆæœ¬è¡¨ï¼‰
- å­˜å‚¨åº“çš„å®Œæ•´å¿«ç…§
- æ”¯æŒæ¢å¤åˆ°å†å²ç‰ˆæœ¬
- `is_current`æ ‡è®°å½“å‰ç‰ˆæœ¬

---

## å…³é”®æ•°æ®æµ

### 1. ç”¨æˆ·è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è®¿é—®é¡µé¢ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ middleware.ts    â”‚ (æ£€æŸ¥è®¤è¯çŠ¶æ€)
â”‚ æ£€æŸ¥ Cookie ä¸­çš„ â”‚
â”‚ Auth Token       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â–º æœªè®¤è¯ â”€â”€â”€â”€â”€â–º é‡å®šå‘åˆ° /ï¼ˆç™»å½•é¡µï¼‰
       â”‚
       â–¼ å·²è®¤è¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½ Dashboard    â”‚
â”‚ AuthContext æä¾› â”‚
â”‚ ç”¨æˆ·ä¿¡æ¯         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. åˆ›å»ºé¡¹ç›®æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"New Project"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NewProjectModal    â”‚ (ç”¨æˆ·è¾“å…¥é¡¹ç›®åç§°å’Œæè¿°)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/projects â”‚ (API Route)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ projectService.ts      â”‚
â”‚ createProject()        â”‚
â”‚ è°ƒç”¨ Supabase å‡½æ•°:    â”‚
â”‚ create_project_with_   â”‚
â”‚ default_resource()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL äº‹åŠ¡:       â”‚
â”‚ 1. æ’å…¥ projects è¡¨    â”‚
â”‚ 2. æ’å…¥ libraries è¡¨   â”‚
â”‚    (é»˜è®¤"Resource"åº“)  â”‚
â”‚ 3. æ’å…¥ project_       â”‚
â”‚    collaborators è¡¨    â”‚
â”‚    (owner as admin)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React Query ç¼“å­˜å¤±æ•ˆ   â”‚
â”‚ é‡æ–°è·å–é¡¹ç›®åˆ—è¡¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI æ›´æ–°ï¼Œæ˜¾ç¤ºæ–°é¡¹ç›®    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. å®æ—¶åä½œç¼–è¾‘æµç¨‹ï¼ˆæœ€å¤æ‚ï¼‰

```
ç”¨æˆ· A ç¼–è¾‘å•å…ƒæ ¼
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CellEditor ç»„ä»¶            â”‚
â”‚ onChange è§¦å‘              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useCellEditing Hook        â”‚
â”‚ handleCellChange()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LibraryDataContext         â”‚
â”‚ updateAssetField()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â–º 1. æ›´æ–° Yjs Doc (æœ¬åœ° CRDT)
         â”‚        Y.Map.set(assetId, fieldId, value)
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â–º 2. è§¦å‘ Yjs observe äº‹ä»¶
         â”‚        â†’ ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ˆä¹è§‚æ›´æ–°ï¼‰
         â”‚
         â””â”€â”€â”€â”€â”€â”€â–º 3. å¼‚æ­¥æ›´æ–° Supabase
                  libraryAssetsService.updateAssetValue()
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Supabase Realtime å¹¿æ’­     â”‚
         â”‚ UPDATE äº‹ä»¶åˆ°å…¶ä»–å®¢æˆ·ç«¯    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ ç”¨æˆ· B çš„å®¢æˆ·ç«¯            â”‚
         â”‚ useRealtimeSubscription    â”‚
         â”‚ æ”¶åˆ° UPDATE äº‹ä»¶           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ LibraryDataContext         â”‚
         â”‚ å¤„ç†è¿œç¨‹æ›´æ–°               â”‚
         â”‚ â†’ æ›´æ–° Yjs Doc             â”‚
         â”‚ â†’ è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ ç”¨æˆ· B çœ‹åˆ°ç”¨æˆ· A çš„ä¿®æ”¹   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Presence Tracking æµç¨‹

```
ç”¨æˆ· A ç‚¹å‡»ç¼–è¾‘æŸä¸ªå•å…ƒæ ¼
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useCellEditing             â”‚
â”‚ setActiveField()           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LibraryDataContext         â”‚
â”‚ setActiveField(assetId,    â”‚
â”‚                fieldId)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ usePresenceTracking        â”‚
â”‚ æ›´æ–° Presence State        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Realtime          â”‚
â”‚ .track() å‘é€ Presence     â”‚
â”‚ æ•°æ®åˆ° Channel             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¶ä»–ç”¨æˆ·æ”¶åˆ° Presence      â”‚
â”‚ presence-track äº‹ä»¶        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CellPresenceAvatars ç»„ä»¶   â”‚
â”‚ æ˜¾ç¤ºç”¨æˆ· A çš„å¤´åƒåœ¨è¯¥å•å…ƒæ ¼â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ—¶åä½œæ¶æ„

### Yjs + Supabase Realtime åŒå±‚æ¶æ„

Keco Studio ä½¿ç”¨äº†ä¸€ä¸ªç‹¬ç‰¹çš„**åŒå±‚å®æ—¶åä½œæ¶æ„**ï¼š

1. **æœ¬åœ°å±‚ï¼ˆYjsï¼‰**: CRDTæ•°æ®ç»“æ„ï¼Œä¿è¯æœ¬åœ°çš„å³æ—¶å“åº”å’Œç¦»çº¿æ”¯æŒ
2. **è¿œç¨‹å±‚ï¼ˆSupabase Realtimeï¼‰**: æ•°æ®åº“å®æ—¶è®¢é˜…ï¼Œä¿è¯è·¨å®¢æˆ·ç«¯çš„æœ€ç»ˆä¸€è‡´æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Client A                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  UI Component â”‚â”€â”€â”€â–ºâ”‚   Yjs Doc    â”‚â—„â”€â”€â”€â”‚  IndexedDB   â”‚ â”‚
â”‚  â”‚  (React)      â”‚â—„â”€â”€â”€â”‚   (CRDT)     â”‚â”€â”€â”€â–ºâ”‚(Persistence) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â”‚                              â”‚
â”‚                               â–¼                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                    â”‚ Supabase Realtime    â”‚                 â”‚
â”‚                    â”‚ WebSocket Connection â”‚                 â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Supabase Backend     â”‚
                    â”‚  PostgreSQL + Realtimeâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Client B                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                    â”‚ Supabase Realtime    â”‚                 â”‚
â”‚                    â”‚ WebSocket Connection â”‚                 â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                               â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  UI Component â”‚â”€â”€â”€â–ºâ”‚   Yjs Doc    â”‚â—„â”€â”€â”€â”‚  IndexedDB   â”‚ â”‚
â”‚  â”‚  (React)      â”‚â—„â”€â”€â”€â”‚   (CRDT)     â”‚â”€â”€â”€â–ºâ”‚(Persistence) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¼˜ç‚¹

1. **å³æ—¶å“åº”**: Yjs CRDTä¿è¯æœ¬åœ°ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€ç­‰å¾…ç½‘ç»œ
2. **å†²çªè§£å†³**: CRDTè‡ªåŠ¨è§£å†³å¹¶å‘ç¼–è¾‘å†²çª
3. **ç¦»çº¿æ”¯æŒ**: IndexedDBæŒä¹…åŒ–ï¼Œç¦»çº¿ä¹Ÿå¯ç¼–è¾‘
4. **æœ€ç»ˆä¸€è‡´æ€§**: Supabase Realtimeä¿è¯è·¨å®¢æˆ·ç«¯çš„æ•°æ®ä¸€è‡´æ€§

### ç¼ºç‚¹ï¼ˆå·²çŸ¥ç—›ç‚¹ï¼‰

1. **åŒé‡çœŸç›¸æº**: Yjså’ŒSupabase DBå¯èƒ½ä¸åŒæ­¥
2. **å¤æ‚æ€§é«˜**: éœ€è¦åŒæ—¶ç®¡ç†Yjså’Œæ•°æ®åº“çŠ¶æ€
3. **è°ƒè¯•å›°éš¾**: çŠ¶æ€åŒæ­¥é—®é¢˜éš¾ä»¥å®šä½

---

## è®¤è¯ä¸æˆæƒ

### è®¤è¯æµç¨‹

1. **Supabase Auth**: åŸºäºJWTçš„è®¤è¯ç³»ç»Ÿ
2. **Cookieå­˜å‚¨**: Tokenå­˜å‚¨åœ¨HTTPOnly Cookieä¸­
3. **ä¸­é—´ä»¶ä¿æŠ¤**: `middleware.ts`æ‹¦æˆªæœªè®¤è¯è¯·æ±‚

### æˆæƒæ¨¡å‹

#### æ•°æ®åº“çº§åˆ«ï¼ˆRow Level Securityï¼‰

æ‰€æœ‰è¡¨éƒ½å¯ç”¨äº†RLSç­–ç•¥ï¼š

```sql
-- é¡¹ç›®è¡¨ï¼šåªèƒ½çœ‹åˆ°è‡ªå·±åˆ›å»ºçš„æˆ–è¢«é‚€è¯·çš„é¡¹ç›®
CREATE POLICY projects_select_policy ON projects
  FOR SELECT USING (
    owner_id = auth.uid()
    OR id IN (
      SELECT project_id FROM project_collaborators
      WHERE user_id = auth.uid() AND accepted_at IS NOT NULL
    )
  );
```

#### åº”ç”¨çº§åˆ«ï¼ˆauthorizationServiceï¼‰

```typescript
// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜¯é¡¹ç›®çš„Admin
export async function isProjectAdmin(
  supabase: SupabaseClient,
  projectId: string,
  userId: string
): Promise<boolean> {
  // æ£€æŸ¥æ˜¯å¦æ˜¯owneræˆ–adminåä½œè€…
}

// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥ç¼–è¾‘
export async function canEditProject(
  supabase: SupabaseClient,
  projectId: string,
  userId: string
): Promise<boolean> {
  // æ£€æŸ¥æ˜¯å¦æ˜¯owner, adminæˆ–editor
}
```

---

## API è·¯ç”±

### API è·¯ç”±åˆ—è¡¨

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/projects` | POST | åˆ›å»ºé¡¹ç›® |
| `/api/projects/[projectId]/libraries` | POST | åˆ›å»ºåº“ |
| `/api/projects/[projectId]/folders` | POST | åˆ›å»ºæ–‡ä»¶å¤¹ |
| `/api/projects/[projectId]/role` | GET | è·å–ç”¨æˆ·åœ¨é¡¹ç›®ä¸­çš„è§’è‰² |
| `/api/projects/[projectId]/delete` | DELETE | åˆ é™¤é¡¹ç›® |
| `/api/libraries/[libraryId]` | PUT | æ›´æ–°åº“ä¿¡æ¯ |
| `/api/libraries/[libraryId]` | DELETE | åˆ é™¤åº“ |
| `/api/collaborators` | GET | è·å–é¡¹ç›®åä½œè€…åˆ—è¡¨ |
| `/api/collaborators/[collaboratorId]` | DELETE | åˆ é™¤åä½œè€… |
| `/api/invitations` | POST | å‘é€åä½œé‚€è¯· |
| `/api/invitations/accept` | POST | æ¥å—é‚€è¯· |
| `/api/invitations/decline` | POST | æ‹’ç»é‚€è¯· |

### API è®¾è®¡æ¨¡å¼

æ‰€æœ‰APIè·¯ç”±éµå¾ªä»¥ä¸‹æ¨¡å¼ï¼š

1. **è®¤è¯æ£€æŸ¥**: ä»Cookieä¸­è·å–Supabase session
2. **æƒé™éªŒè¯**: è°ƒç”¨`authorizationService`æ£€æŸ¥æƒé™
3. **ä¸šåŠ¡é€»è¾‘**: è°ƒç”¨ç›¸åº”çš„Serviceå±‚å‡½æ•°
4. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼

ç¤ºä¾‹ï¼š

```typescript
// app/api/projects/route.ts
export async function POST(request: Request) {
  // 1. åˆ›å»ºSupabaseå®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨è¯»å–Cookieï¼‰
  const supabase = createSupabaseServerClient();
  
  // 2. æ£€æŸ¥è®¤è¯
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
  
  // 3. è§£æè¯·æ±‚ä½“
  const { name, description } = await request.json();
  
  // 4. è°ƒç”¨Serviceå±‚
  const project = await projectService.createProject(supabase, {
    name,
    description,
    owner_id: user.id
  });
  
  // 5. è¿”å›ç»“æœ
  return NextResponse.json(project);
}
```

---

## çŠ¶æ€ç®¡ç†

### çŠ¶æ€ç®¡ç†æ¶æ„

Keco Studio ä½¿ç”¨å¤šå±‚çŠ¶æ€ç®¡ç†æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç»„ä»¶æœ¬åœ°çŠ¶æ€                         â”‚
â”‚                   (useState, useReducer)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  React Context                           â”‚
â”‚  â€¢ AuthContext (ç”¨æˆ·è®¤è¯çŠ¶æ€)                           â”‚
â”‚  â€¢ LibraryDataContext (åº“æ•°æ®å’Œå®æ—¶åä½œ)                â”‚
â”‚  â€¢ PresenceContext (åœ¨çº¿çŠ¶æ€)                           â”‚
â”‚  â€¢ NavigationContext (å¯¼èˆªçŠ¶æ€)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               React Query (Server State)                 â”‚
â”‚  â€¢ é¡¹ç›®åˆ—è¡¨                                             â”‚
â”‚  â€¢ åº“åˆ—è¡¨                                               â”‚
â”‚  â€¢ åä½œè€…åˆ—è¡¨                                           â”‚
â”‚  â€¢ ç‰ˆæœ¬åˆ—è¡¨                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Yjs Doc (CRDT State)                     â”‚
â”‚  â€¢ èµ„äº§æ•°æ® (assets)                                    â”‚
â”‚  â€¢ å­—æ®µå€¼ (asset values)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Supabase (Database State)                   â”‚
â”‚  â€¢ PostgreSQL (æŒä¹…åŒ–æ•°æ®)                              â”‚
â”‚  â€¢ Realtime (å®æ—¶è®¢é˜…)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Context Providers å±‚çº§

```typescript
// app/layout.tsx
<QueryProvider>  {/* React Query */}
  <AuthContext>  {/* è®¤è¯ */}
    <NavigationContext>  {/* å¯¼èˆª */}
      {children}
    </NavigationContext>
  </AuthContext>
</QueryProvider>

// app/(dashboard)/[projectId]/[libraryId]/layout.tsx
<LibraryDataContext libraryId={libraryId} projectId={projectId}>
  <PresenceContext>
    {children}
  </PresenceContext>
</LibraryDataContext>
```

---

## æ–‡ä»¶ä¸Šä¼ ä¸å­˜å‚¨

### Storage Buckets

| Bucket Name | ç”¨é€” | å®‰å…¨ç­–ç•¥ |
|-------------|------|----------|
| `tiptap-images` | Tiptapç¼–è¾‘å™¨å›¾ç‰‡ | è®¤è¯ç”¨æˆ·å¯ä¸Šä¼ ï¼Œå…¬å¼€è¯»å– |
| `library-media-files` | åº“åª’ä½“æ–‡ä»¶ | è®¤è¯ç”¨æˆ·å¯ä¸Šä¼ ï¼Œå…¬å¼€è¯»å– |

### ä¸Šä¼ æµç¨‹

```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯éªŒè¯                   â”‚
â”‚ â€¢ æ–‡ä»¶ç±»å‹                 â”‚
â”‚ â€¢ æ–‡ä»¶å¤§å°ï¼ˆ<10MBï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ imageUploadService/        â”‚
â”‚ mediaFileUploadService     â”‚
â”‚ uploadFile()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Storage           â”‚
â”‚ .upload()                  â”‚
â”‚ è¿”å›å…¬å¼€URL                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿å­˜URLåˆ°                  â”‚
â”‚ library_asset_values       â”‚
â”‚ (value_jsonå­—æ®µ)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç‰ˆæœ¬æ§åˆ¶

### ç‰ˆæœ¬åˆ›å»ºæµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"Create Version"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CreateVersionModal         â”‚
â”‚ è¾“å…¥ç‰ˆæœ¬åç§°               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ versionService.ts          â”‚
â”‚ createVersion()            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â–º 1. è·å–åº“çš„æ‰€æœ‰æ•°æ®
         â”‚        â€¢ library_field_definitions
         â”‚        â€¢ library_assets
         â”‚        â€¢ library_asset_values
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â–º 2. åºåˆ—åŒ–ä¸ºJSONå¿«ç…§
         â”‚        snapshot_data = {
         â”‚          fields: [...],
         â”‚          assets: [...]
         â”‚        }
         â”‚
         â””â”€â”€â”€â”€â”€â”€â–º 3. æ’å…¥ library_versions è¡¨
                  {
                    library_id,
                    version_name,
                    version_type: 'manual',
                    snapshot_data,
                    created_by: user.id,
                    is_current: false
                  }
```

### ç‰ˆæœ¬æ¢å¤æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"Restore Version"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RestoreConfirmModal        â”‚
â”‚ ç¡®è®¤æ¢å¤                   â”‚
â”‚ å¯é€‰ï¼šå¤‡ä»½å½“å‰ç‰ˆæœ¬         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ versionService.ts          â”‚
â”‚ restoreVersion()           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â–º 1. (å¯é€‰)åˆ›å»ºå¤‡ä»½ç‰ˆæœ¬
         â”‚        version_type: 'backup'
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â–º 2. è¯»å–ç›®æ ‡ç‰ˆæœ¬çš„snapshot_data
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â–º 3. æ¸…ç©ºå½“å‰åº“æ•°æ®
         â”‚        â€¢ DELETE library_asset_values
         â”‚        â€¢ DELETE library_assets
         â”‚        â€¢ DELETE library_field_definitions
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â–º 4. æ¢å¤å¿«ç…§æ•°æ®
         â”‚        â€¢ INSERT field definitions
         â”‚        â€¢ INSERT assets
         â”‚        â€¢ INSERT asset values
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â–º 5. åˆ›å»ºæ¢å¤è®°å½•
         â”‚        version_type: 'restore',
         â”‚        restore_from_version_id: ç›®æ ‡ç‰ˆæœ¬ID
         â”‚
         â””â”€â”€â”€â”€â”€â”€â–º 6. æ ‡è®°ä¸ºå½“å‰ç‰ˆæœ¬
                  is_current: true
```

---

## æµ‹è¯•æ¶æ„

### æµ‹è¯•å·¥å…·

- **Playwright**: E2Eæµ‹è¯•æ¡†æ¶
- **æµ‹è¯•æ¨¡å¼**: Page Object Model (POM)

### æµ‹è¯•ç›®å½•ç»“æ„

```
tests/
â””â”€â”€ e2e/
    â”œâ”€â”€ pages/              # Page Object Model
    â”‚   â”œâ”€â”€ project.page.ts
    â”‚   â”œâ”€â”€ library.page.ts
    â”‚   â”œâ”€â”€ asset.page.ts
    â”‚   â””â”€â”€ predefined.page.ts
    â”œâ”€â”€ specs/              # æµ‹è¯•è§„æ ¼
    â”‚   â”œâ”€â”€ auth.spec.ts              # è®¤è¯æµ‹è¯•
    â”‚   â”œâ”€â”€ happy-path.spec.ts        # ä¸»æµç¨‹æµ‹è¯•
    â”‚   â”œâ”€â”€ security.spec.ts          # å®‰å…¨æµ‹è¯•
    â”‚   â”œâ”€â”€ file-upload-security.spec.ts  # æ–‡ä»¶ä¸Šä¼ å®‰å…¨æµ‹è¯•
    â”‚   â”œâ”€â”€ destructive.spec.ts       # ç ´åæ€§æµ‹è¯•ï¼ˆåˆ é™¤æ“ä½œï¼‰
    â”‚   â”œâ”€â”€ version-control.spec.ts   # ç‰ˆæœ¬æ§åˆ¶æµ‹è¯•
    â”‚   â”œâ”€â”€ name-validation.spec.ts   # åç§°éªŒè¯æµ‹è¯•
    â”‚   â””â”€â”€ library-description-tooltip.spec.ts
    â””â”€â”€ fixtures/           # æµ‹è¯•å›ºå®šè£…ç½®
        â””â”€â”€ users.ts
```

### æµ‹è¯•è„šæœ¬

```json
{
  "test:e2e": "playwright test",
  "test:e2e:parallel": "playwright test --workers=50%",
  "test:e2e:clean": "tsx scripts/clean-remote-test-data.ts && playwright test",
  "test:e2e:sequential": "playwright test ... (æŒ‰é¡ºåº)",
  "test:auth": "playwright test tests/e2e/specs/auth.spec.ts",
  "test:happy": "playwright test tests/e2e/specs/happy-path.spec.ts"
}
```

### æµ‹è¯•è¦†ç›–èŒƒå›´

1. **è®¤è¯æµ‹è¯•** (`auth.spec.ts`)
   - ç™»å½•/æ³¨å†Œ
   - ç™»å‡º
   - å¯†ç é‡ç½®

2. **ä¸»æµç¨‹æµ‹è¯•** (`happy-path.spec.ts`)
   - åˆ›å»ºé¡¹ç›®
   - åˆ›å»ºåº“
   - åˆ›å»ºèµ„äº§
   - ç¼–è¾‘å­—æ®µ

3. **å®‰å…¨æµ‹è¯•** (`security.spec.ts`)
   - XSSé˜²æŠ¤
   - SQLæ³¨å…¥é˜²æŠ¤
   - æƒé™éªŒè¯

4. **ç‰ˆæœ¬æ§åˆ¶æµ‹è¯•** (`version-control.spec.ts`)
   - åˆ›å»ºç‰ˆæœ¬
   - æ¢å¤ç‰ˆæœ¬
   - ç‰ˆæœ¬åˆ—è¡¨

---

## éƒ¨ç½²æ¶æ„

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å¼€å‘è€…æœºå™¨                       â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Next.js Dev   â”‚  â”‚ Docker Desktop â”‚ â”‚
â”‚  â”‚  Server        â”‚  â”‚                â”‚ â”‚
â”‚  â”‚  (Port 3000)   â”‚  â”‚  Supabase      â”‚ â”‚
â”‚  â”‚                â”‚  â”‚  Local Stack   â”‚ â”‚
â”‚  â”‚  â€¢ Hot Reload  â”‚  â”‚  â€¢ PostgreSQL  â”‚ â”‚
â”‚  â”‚  â€¢ Fast Refreshâ”‚  â”‚  â€¢ Auth        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â€¢ Storage     â”‚ â”‚
â”‚                      â”‚  â€¢ Realtime    â”‚ â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å¯åŠ¨æµç¨‹ï¼š

```bash
# 1. å¯åŠ¨æœ¬åœ°Supabase
supabase start

# 2. é…ç½®ç¯å¢ƒå˜é‡ (.env.local)
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=<anon_key>

# 3. å®‰è£…ä¾èµ–
npm install

# 4. å¯åŠ¨Next.jså¼€å‘æœåŠ¡å™¨
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨æµ‹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Vercel                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Next.js Production Build          â”‚  â”‚
â”‚  â”‚  â€¢ Server Components (SSR)         â”‚  â”‚
â”‚  â”‚  â€¢ API Routes                      â”‚  â”‚
â”‚  â”‚  â€¢ Static Assets (CDN)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Supabase Cloud                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL (Managed)              â”‚  â”‚
â”‚  â”‚  Auth (JWT)                        â”‚  â”‚
â”‚  â”‚  Storage (S3)                      â”‚  â”‚
â”‚  â”‚  Realtime (WebSocket)              â”‚  â”‚
â”‚  â”‚  Edge Functions                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å·²çŸ¥ç—›ç‚¹

æ ¹æ®é¡¹ç›®ç°çŠ¶å’Œä»£ç åˆ†æï¼Œä»¥ä¸‹æ˜¯å·²è¯†åˆ«çš„æ¶æ„å’Œä»£ç ç—›ç‚¹ï¼š

### 1. å¤æ‚åº¦è¿‡é«˜

**é—®é¢˜**:
- **Sidebar.tsx (2330è¡Œ)**: ä¾§è¾¹æ ç»„ä»¶è¿‡äºåºå¤§ï¼ŒåŒ…å«äº†ç‰ˆæœ¬æ§åˆ¶ã€åä½œè€…ç®¡ç†ã€æ–‡ä»¶å¤¹æ ‘ç­‰å¤šä¸ªåŠŸèƒ½
- **LibraryAssetsTable.tsx (2335è¡Œ)**: è¡¨æ ¼ç»„ä»¶è¿‡äºå¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•
- **LibraryDataContext.tsx (668è¡Œ)**: Contextç»„ä»¶èŒè´£è¿‡å¤šï¼Œé›†æˆäº†æ•°æ®ç®¡ç†ã€å®æ—¶åä½œã€Presence trackingç­‰

**å½±å“**:
- ä¿®æ”¹bugæ—¶å®¹æ˜“å¼•å…¥æ–°é—®é¢˜
- éš¾ä»¥å®šä½é—®é¢˜
- æ–°å¼€å‘è€…ç†è§£å›°éš¾

**å»ºè®®**: å‚è§"ä¼˜åŒ–å»ºè®®æ–‡æ¡£"

### 2. ç›®å½•ç»“æ„æ··ä¹±

**é—®é¢˜**:
- `src/contexts/` å’Œ `src/lib/contexts/` å¹¶å­˜
- `src/hooks/` å’Œ `src/lib/hooks/` å¹¶å­˜
- ç»„ä»¶å†…éƒ¨çš„hooksåˆ†æ•£åœ¨ä¸åŒä½ç½®

**å½±å“**:
- ä»£ç éš¾ä»¥æŸ¥æ‰¾
- å¯¼å…¥è·¯å¾„æ··ä¹±
- å®¹æ˜“äº§ç”Ÿé‡å¤ä»£ç 

### 3. ç›¸å¯¹å¯¼å…¥è·¯å¾„è¿‡å¤š

**é—®é¢˜**:
- 86ä¸ªæ–‡ä»¶ä½¿ç”¨`../`ç›¸å¯¹å¯¼å…¥
- å¯¼å…¥è·¯å¾„éš¾ä»¥ç†è§£å’Œç»´æŠ¤

**ç¤ºä¾‹**:
```typescript
import { something } from '../../../../lib/services/...'
```

**å»ºè®®**:
- ç»Ÿä¸€ä½¿ç”¨`@/`åˆ«åå¯¼å…¥

### 4. åŒé‡çœŸç›¸æºï¼ˆYjs + Supabaseï¼‰

**é—®é¢˜**:
- Yjsæœ¬åœ°çŠ¶æ€å’ŒSupabase DBçŠ¶æ€å¯èƒ½ä¸ä¸€è‡´
- ç½‘ç»œä¸­æ–­æ—¶å¯èƒ½äº§ç”Ÿæ•°æ®ä¸åŒæ­¥
- è°ƒè¯•å›°éš¾ï¼Œéš¾ä»¥ç¡®å®šæ˜¯Yjsé—®é¢˜è¿˜æ˜¯Realtimeé—®é¢˜

**å½±å“**:
- æ•°æ®ä¸€è‡´æ€§é—®é¢˜
- ç”¨æˆ·ä½“éªŒé—®é¢˜ï¼ˆå¶å°”çœ‹åˆ°æ—§æ•°æ®ï¼‰

### 5. ç¼ºä¹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

**é—®é¢˜**:
- APIè·¯ç”±çš„é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€
- å®¢æˆ·ç«¯é”™è¯¯å¤„ç†åˆ†æ•£åœ¨å„ä¸ªç»„ä»¶

**å½±å“**:
- ç”¨æˆ·ä½“éªŒä¸ä¸€è‡´
- éš¾ä»¥è¿½è¸ªé”™è¯¯

### 6. ç±»å‹å®‰å…¨ä¸è¶³

**é—®é¢˜**:
- `tsconfig.json`ä¸­`strict: false`
- å¾ˆå¤š`any`ç±»å‹

**å½±å“**:
- è¿è¡Œæ—¶é”™è¯¯
- IDEæç¤ºä¸å‡†ç¡®

### 7. æµ‹è¯•è¦†ç›–ä¸è¶³

**é—®é¢˜**:
- åªæœ‰E2Eæµ‹è¯•ï¼Œç¼ºå°‘å•å…ƒæµ‹è¯•
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚Servicesï¼‰æ²¡æœ‰æµ‹è¯•è¦†ç›–

**å½±å“**:
- é‡æ„é£é™©é«˜
- éš¾ä»¥ä¿è¯ä»£ç è´¨é‡

### 8. æ€§èƒ½é—®é¢˜

**é—®é¢˜**:
- å¤§å‹è¡¨æ ¼ï¼ˆ>1000è¡Œï¼‰æ¸²æŸ“ç¼“æ…¢
- é¢‘ç¹çš„Realtimeè®¢é˜…å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜
- ç¼ºå°‘è™šæ‹ŸåŒ–æ¸²æŸ“

**å½±å“**:
- ç”¨æˆ·ä½“éªŒå·®
- æµè§ˆå™¨å¯èƒ½å¡é¡¿

### 9. ç¼ºä¹æ–‡æ¡£

**é—®é¢˜**:
- ä»£ç æ³¨é‡Šä¸è¶³
- ç¼ºå°‘æ¶æ„æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£å¡«è¡¥äº†è¿™ä¸ªç©ºç™½ï¼‰
- ç¼ºå°‘APIæ–‡æ¡£

**å½±å“**:
- æ–°å¼€å‘è€…éš¾ä»¥ä¸Šæ‰‹
- ç»´æŠ¤å›°éš¾

---

## æ€»ç»“

### é¡¹ç›®ä¼˜ç‚¹

1. âœ… **åŠŸèƒ½å®Œæ•´**: å®ç°äº†å®Œæ•´çš„åä½œå¼èµ„äº§ç®¡ç†å¹³å°
2. âœ… **æŠ€æœ¯å…ˆè¿›**: ä½¿ç”¨Next.js 16, Supabase, Yjsç­‰ç°ä»£æŠ€æœ¯
3. âœ… **å®æ—¶åä½œ**: å®Œæ•´çš„å¤šäººå®æ—¶ç¼–è¾‘å’ŒPresence tracking
4. âœ… **æƒé™ç®¡ç†**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
5. âœ… **ç‰ˆæœ¬æ§åˆ¶**: æ”¯æŒåº“çš„ç‰ˆæœ¬å¿«ç…§å’Œæ¢å¤
6. âœ… **æµ‹è¯•è¦†ç›–**: æœ‰å®Œæ•´çš„E2Eæµ‹è¯•å¥—ä»¶

### æ”¹è¿›ç©ºé—´

1. ğŸ“Œ **ä»£ç ç»„ç»‡**: é‡æ„è¶…å¤§ç»„ä»¶ï¼Œç»Ÿä¸€ç›®å½•ç»“æ„
2. ğŸ“Œ **ç±»å‹å®‰å…¨**: å¯ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼
3. ğŸ“Œ **æ€§èƒ½ä¼˜åŒ–**: è™šæ‹ŸåŒ–æ¸²æŸ“ï¼Œä¼˜åŒ–Realtimeè®¢é˜…
4. ğŸ“Œ **æµ‹è¯•å®Œå–„**: å¢åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
5. ğŸ“Œ **æ–‡æ¡£å®Œå–„**: å¢åŠ ä»£ç æ³¨é‡Šå’ŒAPIæ–‡æ¡£
6. ğŸ“Œ **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å¤„ç†ç­–ç•¥

---

## é™„å½•

### å…³é”®æŒ‡æ ‡

- **ä»£ç è¡Œæ•°**: ~30,000+ è¡Œï¼ˆä¼°ç®—ï¼‰
- **ç»„ä»¶æ•°é‡**: 82 ä¸ª .tsx æ–‡ä»¶
- **Serviceæ•°é‡**: 13 ä¸ªæœåŠ¡å±‚æ–‡ä»¶
- **æ•°æ®åº“è¡¨**: 15+ ä¸ªæ ¸å¿ƒè¡¨
- **æ•°æ®åº“è¿ç§»**: 40+ ä¸ªè¿ç§»æ–‡ä»¶
- **E2Eæµ‹è¯•**: 10+ ä¸ªæµ‹è¯•è§„æ ¼
- **ä¾èµ–åŒ…**: 30+ ä¸ªç”Ÿäº§ä¾èµ–

### æŠ€æœ¯å€ºåŠ¡ä¼°ç®—

| ç±»åˆ« | ä¸¥é‡ç¨‹åº¦ | ä¼°ç®—å·¥ä½œé‡ |
|------|---------|-----------|
| è¶…å¤§ç»„ä»¶é‡æ„ | é«˜ | 2-3å‘¨ |
| ç›®å½•ç»“æ„æ•´ç† | ä¸­ | 1å‘¨ |
| TypeScriptä¸¥æ ¼æ¨¡å¼ | é«˜ | 2å‘¨ |
| å•å…ƒæµ‹è¯•è¡¥å…… | ä¸­ | 3-4å‘¨ |
| æ€§èƒ½ä¼˜åŒ– | é«˜ | 2å‘¨ |
| æ–‡æ¡£å®Œå–„ | ä½ | 1å‘¨ |

**æ€»è®¡**: çº¦11-13å‘¨çš„é‡æ„å’Œä¼˜åŒ–å·¥ä½œ

---

**æ–‡æ¡£ç»“æŸ**

