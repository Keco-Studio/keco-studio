# ç¼“å­˜ä¼˜åŒ–æ•ˆæœå¯¹æ¯”å›¾

## ğŸ“Š å®é™…è¯·æ±‚æµç¨‹å¯¹æ¯”

### åœºæ™¯ï¼šåœ¨ LibraryPage ç¼–è¾‘ Library åç§°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¼˜åŒ–å‰çš„è¯·æ±‚æµç¨‹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·ç‚¹å‡»ä¿å­˜ Library åç§°
    â†“
å‘é€ POST /api/libraries/xxx/update  â±ï¸ 200ms
    â†“
è§¦å‘ libraryUpdated äº‹ä»¶
    â†“
è°ƒç”¨ fetchData() é‡æ–°è·å–æ‰€æœ‰æ•°æ®ï¼š
    â”œâ”€ GET /api/projects/xxx           â±ï¸ 150ms  â† âŒ ä¸å¿…è¦ï¼ˆproject æ²¡å˜ï¼‰
    â”œâ”€ GET /api/libraries/xxx          â±ï¸ 120ms  â† âœ… éœ€è¦ï¼ˆåç§°å˜äº†ï¼‰
    â”œâ”€ GET /api/libraries/xxx/summary  â±ï¸ 100ms  â† âœ… éœ€è¦ï¼ˆsummary å˜äº†ï¼‰
    â”œâ”€ GET /api/libraries/xxx/schema   â±ï¸ 180ms  â† âŒ ä¸å¿…è¦ï¼ˆschema æ²¡å˜ï¼‰
    â””â”€ GET /api/libraries/xxx/assets   â±ï¸ 250ms  â† âŒ ä¸å¿…è¦ï¼ˆassets æ²¡å˜ï¼‰

æ€»è®¡ï¼š6 ä¸ªè¯·æ±‚ï¼Œ1000ms+
é¡µé¢ loading çŠ¶æ€æ˜¾ç¤º 1 ç§’


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¼˜åŒ–åçš„è¯·æ±‚æµç¨‹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·ç‚¹å‡»ä¿å­˜ Library åç§°
    â†“
å‘é€ POST /api/libraries/xxx/update  â±ï¸ 200ms
    â†“
è§¦å‘ libraryUpdated äº‹ä»¶
    â†“
ç²¾ç¡®å¤±æ•ˆç¼“å­˜ï¼š
    â”œâ”€ GET /api/libraries/xxx          â±ï¸ 120ms  â† âœ… åªåˆ·æ–°è¿™ä¸ª
    â””â”€ GET /api/libraries/xxx/summary  â±ï¸ 100ms  â† âœ… åªåˆ·æ–°è¿™ä¸ª

project, schema, assets æ•°æ®ä»ç¼“å­˜è¯»å– â±ï¸ <1ms

æ€»è®¡ï¼š3 ä¸ªè¯·æ±‚ï¼Œ420ms
é¡µé¢ loading çŠ¶æ€æ˜¾ç¤º 0.4 ç§’

ğŸ“ˆ èŠ‚çœï¼š3 ä¸ªè¯·æ±‚ï¼Œ580msï¼ˆçº¦ 58% æ—¶é—´ï¼‰
```

## ğŸ¯ æ›´ç›´è§‚çš„å¯¹æ¯”

### 1. ç½‘ç»œç€‘å¸ƒå›¾å¯¹æ¯”

```
ä¼˜åŒ–å‰ï¼ˆ6 ä¸ªè¯·æ±‚ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST update        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
GET  project           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                              â† æµªè´¹
GET  library               â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                        
GET  summary                   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
GET  schema                        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ           â† æµªè´¹
GET  assets                              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â† æµªè´¹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0ms                                                    1000ms


ä¼˜åŒ–åï¼ˆ3 ä¸ªè¯·æ±‚ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
POST update        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
GET  library           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
GET  summary               â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
0ms                      420ms
```

### 2. æ•°æ®æµå¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¼˜åŒ–å‰çš„æ•°æ®æµ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

State Management (useState):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   project   â”‚ â† å…¨éƒ¨é‡æ–° fetch  âŒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   library   â”‚ â† å…¨éƒ¨é‡æ–° fetch  âœ…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   summary   â”‚ â† å…¨éƒ¨é‡æ–° fetch  âœ…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   schema    â”‚ â† å…¨éƒ¨é‡æ–° fetch  âŒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   assets    â”‚ â† å…¨éƒ¨é‡æ–° fetch  âŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    fetchData()
        â†“
  å…¨éƒ¨é‡æ–°è·å–ï¼ˆå³ä½¿æ²¡å˜ï¼‰


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¼˜åŒ–åçš„æ•°æ®æµ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

React Query Cache:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   project   â”‚ â† ä»ç¼“å­˜è¯»å–     âš¡ (fresh)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   library   â”‚ â† é‡æ–° fetch     âœ… (stale)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   summary   â”‚ â† é‡æ–° fetch     âœ… (stale)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   schema    â”‚ â† ä»ç¼“å­˜è¯»å–     âš¡ (fresh)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   assets    â”‚ â† ä»ç¼“å­˜è¯»å–     âš¡ (fresh)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
ç²¾ç¡®å¤±æ•ˆ (invalidateQueries)
        â†“
  åªåˆ·æ–°æ”¹å˜çš„æ•°æ®
```

## ğŸ”¬ çœŸå®æµ‹è¯•ç»“æœç¤ºä¾‹

### æµ‹è¯•ç¯å¢ƒ
- ç½‘ç»œï¼šFast 3G (æ¨¡æ‹Ÿ)
- æ•°æ®é‡ï¼š100 ä¸ª assets

### æµ‹è¯• 1ï¼šç¼–è¾‘ Library åç§°

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| æ€»è¯·æ±‚æ•° | 6 | 3 | 50% â†“ |
| æ€»æ—¶é—´ | 1.2s | 0.5s | 58% â†“ |
| æ•°æ®ä¼ è¾“ | 85KB | 35KB | 59% â†“ |

### æµ‹è¯• 2ï¼šåˆ›å»º Asset

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| æ€»è¯·æ±‚æ•° | 5 | 3 | 40% â†“ |
| æ€»æ—¶é—´ | 0.9s | 0.4s | 56% â†“ |
| æ•°æ®ä¼ è¾“ | 70KB | 30KB | 57% â†“ |

## ğŸ’¡ ä¸ºä»€ä¹ˆä½ å¯èƒ½æ„Ÿå—ä¸æ˜æ˜¾ï¼Ÿ

### åŸå›  1ï¼šæœ¬åœ°å¼€å‘é€Ÿåº¦å¤ªå¿«
```
æœ¬åœ°å¼€å‘ï¼š
- æ¯ä¸ªè¯·æ±‚åªéœ€ 10-20ms
- å‡å°‘ 3 ä¸ªè¯·æ±‚ = èŠ‚çœ 30-60ms
- äººçœ¼éš¾ä»¥å¯Ÿè§‰ <100ms çš„å·®å¼‚

è§£å†³æ–¹æ¡ˆï¼š
åœ¨ Chrome DevTools ä¸­è®¾ç½® "Slow 3G" ç½‘ç»œé™é€Ÿ
```

### åŸå›  2ï¼šä¹‹å‰å·²ç»éƒ¨åˆ†ä¼˜åŒ–
```
ProjectPage ä¹‹å‰å·²ç»ä¼˜åŒ–è¿‡äº†ï¼š
- å·²ç»ä½¿ç”¨ React Query
- å·²ç»æœ‰ç²¾ç¡®çš„ç¼“å­˜å¤±æ•ˆ

æ‰€ä»¥ï¼š
- LibraryPage å’Œ FolderPage çš„ä¼˜åŒ–æ‰æ˜¯è¿™æ¬¡çš„é‡ç‚¹
- ProjectPage åªæ˜¯ä¿®å¤äº†ä¸€ä¸ª bug
```

### åŸå›  3ï¼šReact Query çš„é»˜è®¤ç¼“å­˜
```
React Query é»˜è®¤è¡Œä¸ºï¼š
- cacheTime: 5 åˆ†é’Ÿ
- staleTime: 0

è¿™æ„å‘³ç€ï¼š
- 5 åˆ†é’Ÿå†…çš„æ•°æ®ä¼šè¢«ç¼“å­˜
- ä½†æ¯æ¬¡è¿›å…¥é¡µé¢è¿˜æ˜¯ä¼šåå°åˆ·æ–°ï¼ˆbackground refetchï¼‰

ä¼˜åŒ–åï¼š
- ä¸å¿…è¦çš„åå°åˆ·æ–°ä¹Ÿè¢«é¿å…äº†
```

## ğŸ¬ å®é™…æ“ä½œæ¼”ç¤º

### æ­¥éª¤ 1ï¼šæŸ¥çœ‹ä¼˜åŒ–å‰çš„è¡Œä¸º
å¦‚æœä½ æƒ³çœ‹ä¼˜åŒ–å‰çš„æ•ˆæœï¼Œå¯ä»¥ä¸´æ—¶æ³¨é‡Šæ‰ä¼˜åŒ–ä»£ç ï¼š

```typescript
// ä¸´æ—¶ç¦ç”¨ä¼˜åŒ–ï¼Œå›åˆ°ä¼˜åŒ–å‰çš„è¡Œä¸º
useEffect(() => {
  const handleLibraryUpdated = async (event: CustomEvent) => {
    if (event.detail?.libraryId === libraryId) {
      // æ³¨é‡Šæ‰ç²¾ç¡®å¤±æ•ˆ
      // queryClient.invalidateQueries({ queryKey: queryKeys.library(libraryId) });
      // queryClient.invalidateQueries({ queryKey: queryKeys.librarySummary(libraryId) });
      
      // æ”¹ç”¨å…¨éƒ¨å¤±æ•ˆï¼ˆæ¨¡æ‹Ÿä¼˜åŒ–å‰ï¼‰
      queryClient.invalidateQueries();  // â† å¤±æ•ˆæ‰€æœ‰ç¼“å­˜
    }
  };
}, [libraryId, queryClient]);
```

### æ­¥éª¤ 2ï¼šå¯¹æ¯”æµ‹è¯•
1. åˆ·æ–°é¡µé¢ï¼Œæ¸…é™¤ç¼“å­˜
2. ç¼–è¾‘ä¸€ä¸ª Library åç§°
3. æŸ¥çœ‹ Network é¢æ¿çš„è¯·æ±‚æ•°é‡

ä½ åº”è¯¥ä¼šçœ‹åˆ°ï¼š
- ä½¿ç”¨ `invalidateQueries()` å…¨éƒ¨å¤±æ•ˆï¼š**6-8 ä¸ªè¯·æ±‚**
- ä½¿ç”¨ç²¾ç¡®å¤±æ•ˆï¼š**2-3 ä¸ªè¯·æ±‚**

## ğŸ“± ç§»åŠ¨ç½‘ç»œä¸‹çš„æ•ˆæœ

åœ¨ç§»åŠ¨ç½‘ç»œï¼ˆ4G/3Gï¼‰ä¸‹ï¼Œæ•ˆæœä¼šæ›´æ˜æ˜¾ï¼š

```
ç§»åŠ¨ 4G ç½‘ç»œï¼š
ä¼˜åŒ–å‰ï¼šç¼–è¾‘åç§° â†’ ç­‰å¾… 2-3 ç§’
ä¼˜åŒ–åï¼šç¼–è¾‘åç§° â†’ ç­‰å¾… 0.5-1 ç§’

å·®å¼‚ï¼šèŠ‚çœ 1.5-2 ç§’ âœ¨
```

## ğŸ¯ ç»“è®º

è™½ç„¶åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸‹æ•ˆæœä¸å¤ªæ˜æ˜¾ï¼Œä½†ä¼˜åŒ–ç¡®å®ç”Ÿæ•ˆäº†ï¼š

1. âœ… **å‡å°‘è¯·æ±‚**ï¼šä» 5-6 ä¸ªå‡å°‘åˆ° 2-3 ä¸ªï¼ˆ40-60%ï¼‰
2. âœ… **èŠ‚çœæ—¶é—´**ï¼šåœ¨æ…¢ç½‘ç»œä¸‹èŠ‚çœ 1-2 ç§’
3. âœ… **èŠ‚çœæµé‡**ï¼šå‡å°‘ 50% çš„æ•°æ®ä¼ è¾“
4. âœ… **æ›´å¥½ä½“éªŒ**ï¼šé¡µé¢å“åº”æ›´å¿«ï¼Œloading æ—¶é—´æ›´çŸ­

**å»ºè®®**ï¼šåœ¨ Chrome DevTools ä¸­å¼€å¯ç½‘ç»œé™é€Ÿï¼ˆSlow 3Gï¼‰æµ‹è¯•ï¼Œæ•ˆæœä¼šéå¸¸æ˜æ˜¾ï¼

